<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>
        
            HTML5完全学习笔记四：api全解
        
    </title>
    <link rel="icon" href="/img/favicon.png"/>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/hljs.min.css">
    <script src="/js/hljs.min.js"></script>  
    <script src="/js/gitment.browser.js"></script>  
</head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            Toki
        </a>
    </h1>
    <h2>
        <a class="motto">
            Ponyo loves Sōsuke!
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/vevlins/" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/atom.xml" class="menu-item-link">
                        RSS
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <article class="post">
            <h1>
                <a class="title" href="/2017/12/23/HTML5完全学习笔记四：api全解/"> 
                    HTML5完全学习笔记四：api全解 
                </a>
            </h1>
            <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2017-12-23   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a></li></ul>
                
                <a class="tag">
                    <i class="fa fa-tags" aria-hidden="true"></i>  
                </a>
                
                    <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a></li></ul>
            </div>
<div class="toc">
  <ol class="toc-list"><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#HTML5完全学习笔记四：api全解"><span class="toc-list-text">HTML5完全学习笔记四：api全解</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#地理定位"><span class="toc-list-text">地理定位</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#本地存储"><span class="toc-list-text">本地存储</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#webStorage"><span class="toc-list-text">webStorage</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#IndexedDB"><span class="toc-list-text">IndexedDB</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#manifest"><span class="toc-list-text">manifest</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#Web-Workers"><span class="toc-list-text">Web Workers</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#Server-Sent-Events"><span class="toc-list-text">Server-Sent Events</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#前端实现"><span class="toc-list-text">前端实现</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#服务器端实现"><span class="toc-list-text">服务器端实现</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#WebSocket"><span class="toc-list-text">WebSocket</span></a></li></ol></li></ol>
</div>
            <div class="content">
                <h1 id="HTML5完全学习笔记四：api全解"><a href="#HTML5完全学习笔记四：api全解" class="headerlink" title="HTML5完全学习笔记四：api全解"></a>HTML5完全学习笔记四：api全解</h1><h2 id="地理定位"><a href="#地理定位" class="headerlink" title="地理定位"></a>地理定位</h2><p>地理位置 API 通过 navigator.geolocation 提供。默认不开启,需要请求.<br>Geolocation API 的数据来源可能是 GPS、IP 地址、RFID、WiFi、蓝牙 MAC 地址、GSM/CDMA 卡 ID 等。</p>
<p>方法如下:</p>
<ul>
<li>Geolocation.getCurrentPosition():获取位置返回position对象<blockquote>
<p>这会异步地请求获取用户位置，并查询定位硬件来获取最新信息。当定位被确定后，定义的回调函数就会被执行。您可以选择性地提供第二个回调函数，当有错误时会被执行。第三个参数也是可选的，您可以通过该对象参数设定最长可接受的定位返回时间、等待请求的时间和是否获取高精度定位。</p>
</blockquote>
</li>
</ul>
<a id="more"></a>
<pre><code class="javascript">var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};

function success(pos) {
  var crd = pos.coords;
  console.log(&#39;Your current position is:&#39;);
  console.log(&#39;Latitude : &#39; + crd.latitude);
  console.log(&#39;Longitude: &#39; + crd.longitude);
  console.log(&#39;More or less &#39; + crd.accuracy + &#39; meters.&#39;);
};

function error(err) {
  console.warn(&#39;ERROR(&#39; + err.code + &#39;): &#39; + err.message);
};
</code></pre>
<ul>
<li>Geolocation.watchPosition():位置监听器,每当改变,返回一个long类型的监听器id,用来传递给clearwatch停止监听.</li>
<li>Geolocation.clearWatch():取消由 watchPosition()注册的位置监听器。</li>
</ul>
<p>关于getCurrentPosition返回undefined的原因:</p>
<blockquote>
<p>This is because navigator.geolocation.getCurrentPosition is asynchronous. The getGeoLocation function returns before the anonymous callback function passed to getCurrentPosition has been executed, and since the getGeoLocation function has no return statement, it returns undefined.</p>
</blockquote>
<p>这是一个异步执行的函数,由于本身没有返回值,所以返回了undefined.</p>
<h2 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h2><p>H5的本地存储方案主要分为两类:webStorage和IndexedDB.其中webStorage分为localStorage和sessionStorage.indexedDB则是web SQL的替代方案.</p>
<h3 id="webStorage"><a href="#webStorage" class="headerlink" title="webStorage"></a>webStorage</h3><p>localStorage和sessionStorage的操作一致,主要区别是在保存时间上,前者可以一直保存,后者只保存在一个session内.大小限制视不同浏览器在5-20M之间.内部保存方式都是字符串方式,如果需要保存其他类型的数据需要自行转换.方法如下:</p>
<ul>
<li>保存数据：localStorage.setItem(key,value);</li>
<li>读取数据：localStorage.getItem(key);</li>
<li>删除单个数据：localStorage.removeItem(key);</li>
<li>删除所有数据：localStorage.clear();</li>
<li>得到某个索引的key：localStorage.key(index);</li>
</ul>
<h3 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h3><p>IndexedDB是为了能够在客户端存储大量的结构化数据，并且使用索引高效检索的API。采用异步API,其存储方式类似于Nosql.存储空间一般来说不少于250MB。支持事务和二进制存储.</p>
<blockquote>
<p>indexedDB 对象在旧版本的浏览器上是带有前缀的 (在 Gecko &lt; 16的情况下是 mozIndexedDB 属性，Chrome 中是 webkitIndexedDB ，以及IE10 的 msIndexedDB )。</p>
</blockquote>
<h3 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h3><p>HTML5 引入了应用程序缓存，这意味着 web 应用可进行缓存，并可在没有因特网连接时进行访问。浏览器对缓存数据的容量限制可能不太一样（某些浏览器设置的限制是每个站点 5MB）。</p>
<p>manifest 文件是简单的文本文件，它告知浏览器被缓存的内容（以及不缓存的内容）。</p>
<p>manifest 文件可分为三个部分：</p>
<ul>
<li>CACHE MANIFEST - 在此标题下列出的文件将在首次下载后进行缓存</li>
<li>NETWORK - 在此标题下列出的文件需要与服务器的连接，且不会被缓存</li>
<li>FALLBACK - 在此标题下列出的文件规定当页面无法访问时的回退页面（比如 404 页面）</li>
</ul>
<p>一旦文件被缓存，则浏览器会继续展示已缓存的版本，即使您修改了服务器上的文件。为了确保浏览器更新缓存，您需要更新 manifest 文件。</p>
<h2 id="Web-Workers"><a href="#Web-Workers" class="headerlink" title="Web Workers"></a>Web Workers</h2><p>web worker 是运行在后台的 JavaScript,独立于UI进程,可以用来做一些高度消耗CPU的工作.</p>
<p>在外部文件中用postMessage来传送消息,在原文件用onmessage获取消息. <code>w=new Worker(&quot;demo_workers.js&quot;);</code>创建worker,<code>w.terminate();</code>终止worker.</p>
<h2 id="Server-Sent-Events"><a href="#Server-Sent-Events" class="headerlink" title="Server-Sent Events"></a>Server-Sent Events</h2><p>实现服务器向浏览器的推送.SSE使用的是http协议,而WebSocket 是一个独立协议.其用来传送文本信息,可以自定义发送的消息类型.SSE 要求服务器与浏览器保持连接.</p>
<blockquote>
<p>严格地说，HTTP 协议无法做到服务器主动推送信息。但是，有一种变通方法，就是服务器向客户端声明，接下来要发送的是流信息（streaming）。也就是说，发送的不是一次性的数据包，而是一个数据流，会连续不断地发送过来。这时，客户端不会关闭连接，会一直等着服务器发过来的新的数据流，视频播放就是这样的例子。本质上，这种通信就是以流信息的方式，完成一次用时很长的下载。SSE 就是利用这种机制，使用流信息向浏览器推送信息。它基于 HTTP 协议，目前除了 IE/Edge，其他浏览器都支持。</p>
</blockquote>
<h3 id="前端实现"><a href="#前端实现" class="headerlink" title="前端实现"></a>前端实现</h3><p><code>var source = new EventSource(url, { withCredentials: true });</code>生成示例,可以跨域.连接一旦建立，就会触发open事件，可以在onopen属性定义回调函数。客户端收到服务器发来的数据，就会触发message事件，可以在onmessage属性的回调函数。<code>source.close();</code>关闭连接.</p>
<pre><code class="javascript">source.onmessage = function (event) {
  var data = event.data;
  // handle message
};
</code></pre>
<p>默认情况下，服务器发来的数据，总是触发浏览器EventSource实例的message事件。开发者还可以自定义 SSE 事件，这种情况下，发送回来的数据不会触发message事件。</p>
<h3 id="服务器端实现"><a href="#服务器端实现" class="headerlink" title="服务器端实现"></a>服务器端实现</h3><p>Content-Type必须指定 MIME 类型为event-steam.每一次发送的信息，由若干个message组成，每个message之间用\n\n分隔。每个message内部由若干行组成，每一行都是如下格式:<code>[data/event/id/retry]: value\n</code>,此外，还可以有冒号开头的行，表示注释。如果data很长，可以分成多行，最后一行用\n\n结尾，前面行都用\n结尾。数据标识符用id字段表示，相当于每一条数据的编号。event字段表示自定义的事件类型，默认是message事件。服务器可以用retry字段，指定浏览器重新发起连接的时间间隔。</p>
<blockquote>
<p>浏览器用lastEventId属性读取这个值。一旦连接断线，浏览器会发送一个 HTTP 头，里面包含一个特殊的Last-Event-ID头信息，将这个值发送回来，用来帮助服务器端重建连接。因此，这个头信息可以被视为一种同步机制。</p>
</blockquote>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>WebSocket是HTML5开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。在WebSocket API中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。     </p>
<pre><code class="javascript">var ws = new WebSocket(&quot;wss://echo.websocket.org&quot;);
ws.onopen = function(evt) { 
  console.log(&quot;Connection open ...&quot;); 
  ws.send(&quot;Hello WebSockets!&quot;);
};
ws.onmessage = function(evt) {
  console.log( &quot;Received Message: &quot; + evt.data);
  ws.close();
};
ws.onclose = function(evt) {
  console.log(&quot;Connection closed.&quot;);
};
</code></pre>
<p>服务器数据可能是文本，也可能是二进制数据（blob对象或Arraybuffer对象）。实例对象的bufferedAmount属性，表示还有多少字节的二进制数据没有发送出去。它可以用来判断发送是否结束。</p>
<p>参考资料:</p>
<ul>
<li><a href="http://javascript.ruanyifeng.com/bom/indexeddb.html" target="_blank" rel="noopener">IndexedDB：浏览器端数据库 — JavaScript 标准参考教程（alpha）</a></li>
<li><a href="http://www.runoob.com/html/html5-webstorage.html" target="_blank" rel="noopener">HTML5 Web 存储 | 菜鸟教程</a></li>
<li><a href="https://www.cnblogs.com/LuckyWinty/p/5699117.html" target="_blank" rel="noopener">前端HTML5几种存储方式的总结 - 小蚊 - 博客园</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Functions_and_classes_available_to_workers" target="_blank" rel="noopener">Functions and classes available to Web Workers - Web APIs | MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation" target="_blank" rel="noopener">Geolocation - Web API 接口 | MDN</a></li>
<li><a href="http://www.alloyteam.com/2015/11/deep-in-web-worker/" target="_blank" rel="noopener">【转向Javascript系列】深入理解Web Worker | AlloyTeam</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2017/05/server-sent_events.html" target="_blank" rel="noopener">Server-Sent Events 教程 - 阮一峰的网络日志</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">WebSocket 教程 - 阮一峰的网络日志</a></li>
<li><a href="http://websocketd.com" target="_blank" rel="noopener">websocketd</a></li>
</ul>

            </div>
          
           
            <div class="copyright">
                <div class="name">
                    <a>本文作者:</a>
                    <a>Sōsuke</a>
                </div>
                <div class="link">
                    <a>本文链接:</a>
                    <a class="permalink" href="https://vevlins.github.io/2017/12/23/HTML5完全学习笔记四：api全解/">https://vevlins.github.io/2017/12/23/HTML5完全学习笔记四：api全解/</a>
                </div>
                <div class="license">
                    <a>版权声明:</a>
                    <a>本博客所有文章除特别声明外，均采用许可协议 CC BY-NC-SA 3.0 CN。转载请注明出处！</a>
                </div>
            </div>
            

          


</article>


<div class="tip">
<button class="tip-btn">
    打赏
</button>
<div class="tip-img">
<ul>
    
<li>
    <img src="/img/qrcode.jpeg"></img>
</li>

 
<li>
    <img src="/img/qrcode.jpeg"></img>
</li>

</ul>
</div>
</div>

<div class="more">

<div></div>

    <div class="next">
    <a href="/2017/12/23/HTML5完全学习笔记三：canvas全解/"> HTML5完全学习笔记三：canvas全解 </a>
    </div>
    
</div>

<div class="bdsharebuttonbox">
<a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信" style="color:#1cbd8f">
</a>
<a href="#" class="bds_tsina fa fa-weibo" data-cmd="tsina" title="分享到新浪微博" style="color:#ff6363">
</a>
<a href="#" class="bds_twi fa fa-twitter" data-cmd="twi" title="分享到Twitter" style="color:#00A7EB">
</a>
<a href="#" class="bds_fbook fa fa-facebook" data-cmd="fbook" title="分享到Facebook" style="color:#00A7EB">
</a>
</div>
<script>
window._bd_share_config={
    "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},
    "share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='../../../../../static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 
<div id="comments"></div>

<script>
    var gitment = new Gitment({
    id: "Sat Dec 23 2017 18:58:41 GMT+0800",
    owner: "Vevlins",
    repo: "Vevlins.github.io",
    oauth: {
      client_id:"8d83609a651e972e308d",
      client_secret: "37e40c89a47e957f654e86f71c5caaccad0774de",
    }
  })
  gitment.render('comments')
</script>
    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
    <div class="footer-copyright">©️2017
    <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>  by Vevlins
    </div>
</footer>

    <script src="/js/jquery.js"></script>
    <script src="/js/toki.js"></script>  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>